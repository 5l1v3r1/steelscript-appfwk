{% extends "base.html" %}
{% block comments %}
<!--
# Copyright (c) 2015 Riverbed Technology, Inc.
#
# This software is licensed under the terms and conditions of the MIT License
# accompanying the software ("License").  This software is distributed "AS IS"
# as set forth in the License.
-->
{% endblock %}

{% block title %}App Framework: Report History{% endblock %}

{% block header_row %}
    <h3>Report History</h3>
{% endblock %}

{% block header %}
    <script type="text/javascript">
        $(document).ready( function() {
            {% if history %}
                YUI().use("datatable-sort", function(Y) {
                    cols = [
                            {key:"namespace", label:"Namespace", sortable:true},
                            {key:"slug", label:"Report Slug", sortable:true},
                            {key:"first_run", label:"First Run", sortable:true},
                            {key:"last_run", label:"Last Run", sortable:true},
                            {key:"status", label:"Status", sortable:true},
                            {key:"user", label:"User", sortable:true},
                            {key:"criteria", label:"Criteria",
                             sortable:false, allowHTML:true},
                            {key:"run_count", label:"Run Count", sortable:true},
                            {key:"run", label:"Run",
                             sortable:false, allowHTML:true,
                             formatter:'<a href={value} class="btn btn-info" role="button">Run</a>'},

                    ],
                    data = [
                        {% for record in history %}
                            {namespace:"{{ record.namespace }}",
                             slug:"{{ record.slug }}",
                             first_run:"{{ record.first_run }}",
                             last_run:"{{ record.last_run }}",
                             status:"{{ record.status_name }}",
                             user:"{{ record.user }}",
                             criteria:"{{ record.criteria_html|safe }}",
                             run_count:"{{ record.run_count }}",
                             run:"{{ record.bookmark|safe }}",
                             },
                        {% endfor %}
                    ],
                    table = new Y.DataTable({
                        columns: cols,
                        data: data,
                        summary: "Report History",
                    }).render('#sort');
                });
            {% endif %}
        });
    </script>

    <style type="text/css">
        .form-inline input {
            margin-bottom: 5px;
        }
    </style>

{% endblock %}

{% block content %}
    {% if history %}
        <div id="results-container" class="container-fluid">
            <div id="sort" class="row-fluid yui3-skin-sam" align="center">
            </div>
        </div>
    {% endif %}
    <P></P>
    <script type="text/javascript">
        (function refresh() {
             setTimeout(function() {
                  location.reload();
                  }, 30000);
              }
        )();
    </script>
{% endblock %}


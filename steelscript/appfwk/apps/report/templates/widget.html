<!DOCTYPE html>

<!--
# Copyright (c) 2014 Riverbed Technology, Inc.
#
# This software is licensed under the terms and conditions of the MIT License
# accompanying the software ("License").  This software is distributed "AS IS"
# as set forth in the License.
-->

<!--
Add header
-->

{% load url from future %}
<html>
  <head>
    <title>{% block title %}SteelScript App Framework{% endblock %}</title>

    {% include "site_header_includes.html" %}

    <link href="{{ STATIC_URL }}css/report.css" rel="stylesheet"/>
    <script type="text/javascript" src="{{ STATIC_URL }}showLoading/js/jquery.showLoading.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}jquery-timepicker/jquery.timepicker.min.js"></script>

    {% if maps_version == 'DEVELOPER' %}
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    {% elif maps_version == 'FREE' %}
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3%key={{ maps_api_key }}&sensor=false"></script>
    {% elif maps_version == 'BUSINESS' %}
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3&client={{ maps_api_key }}&sensor=false"></script>
    {% endif %}

    <script type="text/javascript" src="{{ STATIC_URL }}js/rvbd-widgets.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/rvbd-report.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/rvbd-yui3.js"></script>

    {% if maps_version == 'OPEN_STREET_MAPS' %}
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.js"></script>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.css" />
        <script type="text/javascript" src="{{ STATIC_URL }}js/rvbd-openstreetmaps.js"></script>
    {% else %}
        <script type="text/javascript" src="{{ STATIC_URL }}js/rvbd-google-maps.js"></script>
    {% endif %}


    <script type="text/javascript">
      var runRequested = false;
      var debugFlag = false;
      $(document).ready( function() {
          $.ajaxSetup({
              beforeSend: function(xhr) {
                  xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
              }
          });
          // rvbd_debug_url is used in report.js to allow the user to download a zip
          // of the debug information if rvbd_debug is set to true.
          rvbd_debug_url = "{% url 'steelscript.appfwk.apps.report.views.download_debug' %}";

          // Immediately render the page and run the widget
          var widget_info = {"widgetid": {{ widget.widgetid }},
                             "criteria": '{{ widget.criteria }}'
                            };
          renderPage("{% url 'report-widgets' widget.namespace widget.report_slug %}", widget_info);
          dorun();
        });

    </script>
    <style>
        .loading-indicator
        {
            height: 80px;
            width: 80px;
            background: url( '{{ STATIC_URL }}showLoading/images/loading.gif' );
            background-repeat: no-repeat;
            background-position: center center;
        }
    </style>
  </head>
  <body>
      <div class="row-fluid">
          <div class="collapse in" id="report-container">
            <div class="widget-content collapse in" id="report">
            </div> <!-- criteria -->
          </div> <!-- criteria -->
    </div>

  </body>
</html>

